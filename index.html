<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>館長のリズムゲーム</title>

<style>
body{
    margin:0;
    background:#0b0f1a;
    color:white;
    font-family:sans-serif;
    text-align:center;
}

h1{
    margin:10px;
}

#game{
    position:relative;
    margin:auto;
    width:300px;
    height:500px;
    background:#111;
    overflow:hidden;
    border:3px solid #444;
    border-radius:10px;
}

.lane{
    position:absolute;
    bottom:0;
    width:33.33%;
    height:100%;
    border-left:1px solid #333;
}

#hitline{
    position:absolute;
    bottom:80px;
    width:100%;
    height:5px;
    background:yellow;
}

.note{
    position:absolute;
    width:33.33%;
    height:20px;
    background:cyan;
    border-radius:5px;
}

button{
    width:90px;
    height:60px;
    margin:5px;
    font-size:20px;
}

#score{
    font-size:20px;
}
</style>
</head>

<body>

<h1>館長のリズムゲーム</h1>

<div id="score">
Score: <span id="s">0</span>
Combo: <span id="c">0</span>
</div>

<div id="game">
    <div class="lane" style="left:0%"></div>
    <div class="lane" style="left:33.33%"></div>
    <div class="lane" style="left:66.66%"></div>
    <div id="hitline"></div>
</div>

<div>
<button onclick="hit(0)">A</button>
<button onclick="hit(1)">S</button>
<button onclick="hit(2)">D</button>
</div>

<script>
let score=0
let combo=0
let notes=[]

function spawnNote(){
    let lane=Math.floor(Math.random()*3)

    let n=document.createElement("div")
    n.className="note"
    n.style.left=(lane*33.33)+"%"
    n.style.top="0px"
    document.getElementById("game").appendChild(n)

    notes.push({el:n,lane:lane,y:0})
}

setInterval(spawnNote,800)

function gameLoop(){
    let hitY=420

    notes.forEach((n,i)=>{
        n.y+=4
        n.el.style.top=n.y+"px"

        if(n.y>500){
            miss(n,i)
        }
    })
}
setInterval(gameLoop,16)

function hit(lane){
    let hitY=420
    let window=25

    for(let i=0;i<notes.length;i++){
        let n=notes[i]
        if(n.lane===lane && Math.abs(n.y-hitY)<window){

            score+=100
            combo++
            update()

            n.el.remove()
            notes.splice(i,1)
            return
        }
    }

    combo=0
    update()
}

function miss(n,i){
    combo=0
    update()
    n.el.remove()
    notes.splice(i,1)
}

function update(){
    s.textContent=score
    c.textContent=combo
}
</script>

</body>
</html>
