<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>館長のリズムゲーム</title>

<style>
body{
    margin:0;
    background:#0b0f1a;
    color:white;
    font-family:sans-serif;
    text-align:center;
}

h1{
    margin:15px;
    font-size:32px;
}

#game{
    position:relative;
    margin:auto;
    width:min(90vw, 600px);
    height:min(75vh, 800px);
    background:#111;
    overflow:hidden;
    border:4px solid #444;
    border-radius:12px;
}

.lane{
    position:absolute;
    bottom:0;
    width:33.33%;
    height:100%;
    border-left:2px solid #333;
}

#hitline{
    position:absolute;
    bottom:120px;
    width:100%;
    height:6px;
    background:yellow;
}

.note{
    position:absolute;
    width:33.33%;
    height:26px;
    background:cyan;
    border-radius:6px;
}

button{
    width:140px;
    height:80px;
    margin:8px;
    font-size:24px;
    border-radius:10px;
}

#startBtn{
    background:#00cc88;
    font-size:26px;
}

#score{
    font-size:24px;
}
</style>
</head>

<body>

<h1>館長のリズムゲーム</h1>

<div id="score">
Score: <span id="s">0</span>
Combo: <span id="c">0</span>
</div>

<button onclick="startGame()" id="startBtn">
▶ 音楽スタート
</button>

<div id="game">
    <div class="lane" style="left:0%"></div>
    <div class="lane" style="left:33.33%"></div>
    <div class="lane" style="left:66.66%"></div>
    <div id="hitline"></div>
</div>

<div>
<button onclick="hit(0)">A</button>
<button onclick="hit(1)">S</button>
<button onclick="hit(2)">D</button>
</div>

<script>

let score=0
let combo=0
let notes=[]
let gameStarted=false

// ★ 音楽読み込み
let music = new Audio("music.mp3")
music.loop = true

// ★ スタート（スマホ対策）
function startGame(){
    music.play()
    gameStarted=true
    document.getElementById("startBtn").style.display="none"
}

// ノーツ生成
function spawnNote(){
    if(!gameStarted) return

    let lane=Math.floor(Math.random()*3)

    let n=document.createElement("div")
    n.className="note"
    n.style.left=(lane*33.33)+"%"
    n.style.top="0px"
    document.getElementById("game").appendChild(n)

    notes.push({el:n,lane:lane,y:0})
}

setInterval(spawnNote,700)

// 落下処理
function gameLoop(){
    let hitY=620

    notes.forEach((n,i)=>{
        n.y+=5
        n.el.style.top=n.y+"px"

        if(n.y>900){
            miss(n,i)
        }
    })
}
setInterval(gameLoop,16)

// ヒット判定
function hit(lane){
    let hitY=620
    let window=40

    for(let i=0;i<notes.length;i++){
        let n=notes[i]
        if(n.lane===lane && Math.abs(n.y-hitY)<window){

            score+=100
            combo++
            update()

            n.el.remove()
            notes.splice(i,1)
            return
        }
    }

    combo=0
    update()
}

function miss(n,i){
    combo=0
    update()
    n.el.remove()
    notes.splice(i,1)
}

function update(){
    s.textContent=score
    c.textContent=combo
}

</script>

</body>
</html>
