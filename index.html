<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>館長のリズムゲーム</title>

<style>
body{
 margin:0;
 background:#0b0f1a;
 color:white;
 text-align:center;
 font-family:sans-serif;
}

#game{
 position:relative;
 width:100vw;
 height:70vh;
 background:#111;
 overflow:hidden;
}

.note{
 position:absolute;
 width:30vw;
 height:40px;
 background:cyan;
 border-radius:8px;
}

#score{font-size:22px}
</style>
</head>

<body>

<h2>館長のリズムゲーム</h2>
<div id="score">Score:0</div>
<div id="timer">60</div>

<div id="game"></div>

<script>

const URL="https://script.google.com/macros/s/AKfycbzSt5ojOfCBkLGf4wr7SQpTaYbnxLe5n0PTa0CRxYaEO64EXhajH94CunkZb_kNrbEN/exec"

let score=0
let time=60
let notes=[]

function spawn(){
 const lane=Math.floor(Math.random()*3)

 const n=document.createElement("div")
 n.className="note"
 n.style.left=(lane*33)+"vw"
 n.style.top="0px"

 game.appendChild(n)
 notes.push({el:n,y:0})

 n.onclick=()=>{
    score+=100
    update()
    n.remove()
 }
}

setInterval(spawn,700)

function loop(){
 notes.forEach(n=>{
   n.y+=6
   n.el.style.top=n.y+"px"
 })
}
setInterval(loop,16)

function update(){
 scoreText.textContent="Score:"+score
}

const scoreText=document.getElementById("score")

setInterval(()=>{
 time--
 document.getElementById("timer").textContent=time
 if(time<=0)finish()
},1000)

function finish(){
 const name=prompt("名前入力（ランキング送信）")
 if(name){
  fetch(URL,{
    method:"POST",
    body:JSON.stringify({
      name:name,
      score:score,
      game:"リズムゲーム"
    })
  })
 }
 location.reload()
}

</script>
</body>
</html>
